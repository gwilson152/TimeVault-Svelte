# TimeVault - Svelte Code Generation Guidelines

## Table of Contents
- [Introduction](#introduction)
- [Svelte 5 Implementation](#svelte-5-implementation)
  - [Class Handling](#class-handling)
  - [Event Handling](#event-handling)
  - [Props and State Management](#props-and-state-management)
  - [Content Rendering](#content-rendering)
  - [Bindings](#bindings)
  - [Variable Naming](#variable-naming)
- [Component Guidelines](#component-guidelines)
  - [ClientSearch Component](#clientsearch-component)
  - [TabView Component](#tabview-component)
  - [GlassCard Component](#glasscard-component)
  - [Modal Component](#modal-component)
- [Styling Guidelines](#styling-guidelines)
  - [File Organization](#style-file-organization)
  - [Implementation](#style-implementation)
  - [Form Styling](#form-styling)
  - [Table Styling](#table-styling)
- [Business Logic Rules](#business-logic-requirements)
  - [Client Management](#client-management-business-rules)
  - [Time Entry Logic](#time-entry-logic)
  - [Billing Calculations](#billing-rate-calculations)
- [Project Overview](#timevault)
  - [Features](#features)
  - [Technologies](#technologies)
  - [Project Structure](#project-structure)
  - [Key Concepts](#key-concepts)
  - [Setup & Deployment](#getting-started)

## Introduction

TimeVault is a modern time management system built with SvelteKit and Svelte 5, designed for freelancers, consultants, and small businesses to track time, manage clients, and generate invoices.

> **IMPORTANT**: NEVER update package.json directly for package installation. Use npm install.

## Svelte 5 Implementation

### Class Handling
Use string interpolation for conditional classes instead of class: directives:

✅ **Correct:**
```svelte
<div class="base-class {condition ? 'active' : ''} {anotherCondition ? 'highlight' : ''}">
```

❌ **Incorrect:**
```svelte
<div class="base-class" class:active={condition} class:highlight={anotherCondition}>
```

### Event Handling
Always use Svelte 5 event handling syntax:

✅ **Correct:**
```svelte
<button onclick={handleClick}>Click me</button>
<input oninput={handleInput} />
<form onsubmit={handleSubmit}>
```

❌ **Incorrect:**
```svelte
<button on:click={handleClick}>Click me</button>
<input on:input={handleInput} />
<form onsubmit|preventDefault={handleSubmit}>  <!-- This causes errors! -->
```

For form submissions, always use preventDefault in the handler function:
```svelte
function handleSubmit(event: SubmitEvent) {
  event.preventDefault();
  // Form handling logic here
}
```

### Props and State Management
- Use `$props()` for component props in runes mode
- Use `let prop = $state()` for local state management
- Use `$derived()` for computed values

**IMPORTANT**: `$state()` can ONLY be used:
1. As a variable declaration initializer: `let x = $state(value)`
2. As a class field: `class X { y = $state(value) }`
3. NEVER inside object destructuring or other expressions

### Variable Naming
NEVER use variable names with a $ prefix as it's reserved in Svelte:

✅ **Correct:**
```svelte
let prevValue = $state(null);
let lastTicketId = $state('');
```

❌ **Incorrect:**
```svelte
let $prevValue = $state(null);
let $lastTicketId = $state('');
```

### Content Rendering
You CANNOT use both `<slot>` elements and `{@render ...}` tags in the same component.

#### Option 1: Using {@render ...} tags (Recommended)
```svelte
<!-- Component definition -->
<script lang="ts">
  const props = $props<{
    content: () => any;
    tabs?: Record<string, () => any>;
  }>();
</script>

<div>
  {@render props.content()}
  
  {#if props.tabs}
    {#each Object.entries(props.tabs) as [id, renderFn]}
      {@render renderFn()}
    {/each}
  {/if}
</div>
```

#### Option 2: Using slots (Traditional)
```svelte
<!-- Component definition -->
<script lang="ts">
  // Props here
</script>

<div>
  <slot />
  
  <div>
    <slot name="footer" />
  </div>
</div>
```

### Bindings
Use Svelte 5 bind: syntax for two-way bindings:
```svelte
<input bind:value={searchQuery} />
```

## Component Guidelines

### ClientSearch Component
**Props:**
- `selectedClientId?: string | null` - Currently selected client ID
- `label?: string` - Label text (default: 'Client')
- `placeholder?: string` - Placeholder text (default: 'Select a client')
- `showSearch?: boolean` - Show search input (default: true)
- `showIcon?: boolean` - Show client icon (default: true)
- `className?: string` - Additional classes for container
- `fieldClassName?: string` - Additional classes for field wrapper
- `hint?: string` - Custom hint text
- `restrictToClientId?: string | null` - Restrict to specific client hierarchy
- `allowNullSelection?: boolean` - Allow no selection (default: true)

**Events:**
- `on:change` - Emits when selection changes, detail is the new client ID or null

### TabView Component
Pass tab content and icons as functions that return renderable content:

```svelte
<TabView 
  tabs={[
    { 
      id: 'tab1', 
      title: 'Tab 1',
      icon: () => InformationCircle({ class: 'h-4 w-4' })  // Icons must be functions
    }
  ]}
  tabContent={{
    tab1: () => {
      return {
        component: GlassCard,        // Component to render
        props: {                     // Props for the component
          class: "p-6"
        },
        content: `                   // HTML content to render inside
          <div>
            <p>Tab content here</p>
            <button data-action="click">Action</button>
          </div>
        `,
        handlers: {                  // Optional event handlers
          onMount: (element) => {
            // Setup event handlers
            return () => {
              // Cleanup function
            };
          }
        }
      };
    }
  }}
/>
```

**Important Notes**:
1. Both icons and content must be functions that return rendered content
2. Never use JSX fragment syntax (`<>...</>`)
3. Always wrap content in container elements
4. Use data attributes for event delegation
5. Include cleanup functions in handlers

### GlassCard Component
- Use for creating glass-morphism effects in the UI
- Configurable padding and class name props

### Modal Component
- Features: ESC key closes, overlay click closes, ARIA attributes
- Props: `open` (boolean), `title` (string), `width` (string)
- Events: `on:close`

## Styling Guidelines

### Style File Organization
1. Global styles: `/src/lib/styles/tailwind-theme.css`
2. Component styles: `/src/lib/styles/components/`
3. Import component styles in `tailwind-theme.css`

### Style Implementation
1. Use Tailwind utility classes when possible
2. Define custom classes under `@layer components`
3. Use unique prefixes to avoid collisions
4. Available base classes:
   - `container-glass`: Base glass effect
   - `light-glass`: Lighter variant
   - `card-glass`: Pre-configured card style

### Form Styling
Use consistent form classes from tailwind-theme.css:
- Container: `form-group`, `form-field`
- Input: `form-input`, `form-select`, `form-textarea`
- Text: `form-label`, `form-hint`, `form-error`
- Button: `form-submit` (add `.loading` for loading state)

### Table Styling
Use consistent table classes:
- `data-table`: Base class for all tables
- `data-table-header`: Header row styling 
- `data-table-row`: Body row styling with hover effect
- `data-table-footer`: Footer row styling
- Use `right-aligned` class for numeric columns

## Business Logic Requirements

### Client Management Business Rules
- Client types: 'business', 'individual', 'container'
- Only 'business' and 'container' clients can be parent clients
- Filter out non-business and non-container clients from parents dropdown
- Handle empty string parentId values by converting to null before API calls

#### Client Hierarchy Display
- Use proper indentation to show parent-child relationships
- Use Heroicons for client type indicators:
  - Business: BuildingOffice
  - Container: Folder
  - Individual: User

### Time Entry Logic
- Use `duration` (not `hours`) for tracking time spent
- Client is optional for time entries
- Display formats:
  - Compact: `duration.toFixed(1)`
  - Formatted: `formatTime(duration)` from invoiceUtils
- Locked entries (associated with invoices) cannot be modified

### Billing Rate Calculations
```typescript
const effectiveRate = override 
  ? override.type === 'percentage' 
    ? (baseRate * override.value / 100) 
    : override.value
  : baseRate;
```

## TimeVault

### Features
- **Time Entry Management**: Track hours with descriptions, dates, client associations
- **Client Management**: Maintain clients with customized hourly rates
- **Invoice Generation**: Create invoices for billable time entries
- **Responsive Design**: Works on desktop and mobile
- **TypeScript**: Full type safety throughout
- **Svelte 5**: Latest Svelte features

### Technologies
- **SvelteKit**: Modern web framework with SSR
- **Svelte 5**: Latest version with reactive primitives
- **TypeScript**: Type-safe JavaScript
- **TailwindCSS**: Utility-first CSS framework
- **UUID**: For unique identifier generation

### Project Structure
```
timevault/
├── src/
│   ├── lib/
│   │   ├── components/
│   │   ├── stores/
│   │   ├── types/
│   │   └── utils/
│   ├── routes/
│   └── app.d.ts
├── static/
├── package.json
└── vite.config.ts
```

### Key Concepts
- **Time Entries**: Blocks of work with description, duration, client association
- **Clients**: Businesses or individuals with customized hourly rates
- **Invoices**: Generated from unbilled time entries

### Getting Started
```bash
# Clone repository
git clone https://github.com/yourusername/timevault.git
cd timevault

# Install dependencies
npm install

# Start development server
npm run dev
```

## Best Practices
- Implement proper loading states and error handling
- Extract reusable logic into stores or utility functions
- Follow ARIA best practices for accessibility
- Cache expensive computations with $derived
- Use consistent page structure across the application
